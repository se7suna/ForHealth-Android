# 用户信息管理模块 - Issues 更新内容汇总

由于GitLab API权限问题，以下是所有issues的格式化内容，您可以直接复制粘贴到对应的GitLab issue中进行手动更新。

---

## Issue #2: 用户注册

# Card

作为新用户，我想使用邮箱和密码创建新的账户，以便开始使用卡路里记录系统进行健康管理。

# Conversation

1. 用户在注册界面输入用户名、有效的邮箱地址和密码
2. 用户点击注册按钮提交表单
3. 后端接收注册请求，验证邮箱格式是否正确
4. 系统检查数据库中该邮箱是否已被注册
5. 如果邮箱未注册且格式正确,系统将邮箱和加密后的密码存储至数据库
6. 系统创建新的用户记录，并生成用户ID
7. 向用户邮箱发送验证邮件（可选）
8. 返回注册成功响应，引导用户进行身体基本数据收集

# Confirmation

1. 邮箱格式验证通过（符合标准邮箱格式）
2. 数据库中未查询到相同邮箱
3. 密码采用安全加密算法（如BCrypt）存储
4. 用户记录成功创建，包含用户ID、邮箱、加密密码、创建时间等字段
5. 注册成功后返回适当的HTTP状态码（201 Created）和用户基本信息
6. 如果邮箱已存在，返回明确的错误提示（409 Conflict）
7. 如果邮箱格式不正确，返回验证错误（400 Bad Request）
8. 系统引导用户进入下一步身体数据收集流程

**参考**: SRS文档第5页 - 账号信息管理模块 - 用户注册功能

---

## Issue #4: 用户身体基本数据收集

# Card

作为新注册的用户，我想输入我的身体基本数据（身高、体重、年龄、性别），以便系统能够准确计算我的基础代谢率（BMR）和每日总能量消耗（TDEE）。

# Conversation

1. 用户完成注册后，系统自动跳转到身体基本数据收集界面
2. 用户输入身高（单位：厘米）、体重（单位：公斤）、年龄（单位：岁）
3. 用户选择性别（男/女）
4. 用户点击提交按钮
5. 后端接收数据并进行格式验证（数值范围合理性检查）
6. 系统使用Mifflin-St Jeor公式计算基础代谢率（BMR）
7. 系统将身体数据存储到用户档案中
8. 返回成功响应，引导用户进入下一步活动水平选择

# Confirmation

1. 所有输入字段验证通过（身高：50-250cm，体重：20-300kg，年龄：10-120岁）
2. 性别选择为必填项
3. 系统正确计算BMR：男性 = 10×体重(kg) + 6.25×身高(cm) - 5×年龄 + 5；女性 = 10×体重(kg) + 6.25×身高(cm) - 5×年龄 - 161
4. 身体数据成功保存到数据库用户档案表中
5. 提交成功返回HTTP状态码200 OK
6. 如果数据格式不正确或超出范围，返回400 Bad Request及具体错误信息
7. 界面自动跳转到活动水平选择页面

**参考**: SRS文档第5页 - 账号信息管理模块 - 用户身体基本数据收集功能

---

## Issue #5: 健康目标设定

# Card

作为用户，我想设定我的健康目标（减重、增重或保持体重），以便系统能够为我计算合适的每日卡路里摄入目标。

# Conversation

1. 用户在健康目标设定界面选择目标类型：减重/增重/保持体重
2. 如果选择减重或增重，用户输入目标体重（单位：公斤）
3. 用户输入期望达成目标的时间周期（单位：周）
4. 用户点击确认按钮提交
5. 后端接收目标数据并验证合理性
6. 系统根据目标类型计算每日卡路里目标：减重（TDEE - 500卡），增重（TDEE + 500卡），保持（TDEE）
7. 系统将健康目标数据存储到用户档案中
8. 返回成功响应，显示计算出的每日卡路里目标

# Confirmation

1. 目标类型选择为必填项（减重/增重/保持体重三选一）
2. 目标体重在合理范围内（相对当前体重变化不超过±50kg）
3. 时间周期在合理范围内（1-104周，即1周到2年）
4. 系统正确计算每日卡路里目标：减重（TDEE - 500），增重（TDEE + 500），保持（TDEE）
5. 健康目标数据成功保存到数据库
6. 提交成功返回HTTP状态码200 OK及计算出的卡路里目标
7. 如果数据不合理，返回400 Bad Request及具体验证错误信息
8. 界面显示目标设定成功确认信息和每日卡路里目标值

**参考**: SRS文档第5-6页 - 账号信息管理模块 - 健康目标设定功能

---

## Issue #6: 活动水平选择

# Card

作为用户，我想选择我的日常活动水平（久坐、轻度活动、中度活动、重度活动、极重度活动），以便系统能够准确计算我的每日总能量消耗（TDEE）。

# Conversation

1. 用户在活动水平选择界面查看各个活动水平的描述说明
2. 用户根据自己的日常活动情况选择对应的活动水平
3. 界面显示该活动水平对应的PAL（Physical Activity Level）系数
4. 用户点击确认按钮提交选择
5. 后端接收活动水平数据
6. 系统根据BMR和选择的PAL系数计算TDEE（TDEE = BMR × PAL系数）
7. 系统将活动水平和计算出的TDEE存储到用户档案中
8. 返回成功响应，显示计算出的TDEE值

# Confirmation

1. 活动水平选择为必填项
2. PAL系数对照表正确：久坐（1.2）、轻度活动（1.375）、中度活动（1.55）、重度活动（1.725）、极重度活动（1.9）
3. 系统正确计算TDEE = BMR × PAL系数
4. 活动水平和TDEE值成功保存到数据库用户档案表中
5. 提交成功返回HTTP状态码200 OK及计算出的TDEE
6. 界面显示活动水平选择成功确认信息和TDEE值
7. 用户可以随时返回修改活动水平，系统重新计算TDEE

**参考**: SRS文档第6页 - 账号信息管理模块 - 活动水平选择功能

---

## Issue #7: 个人资料查看与编辑

# Card

作为已登录的用户，我想查看和编辑我的个人资料（包括身体数据、健康目标、活动水平等），以便随时更新我的信息以保持系统计算的准确性。

# Conversation

1. 用户登录后点击个人中心或个人资料入口
2. 系统从数据库获取用户的完整档案信息
3. 界面展示用户的所有个人信息：邮箱、用户名、身高、体重、年龄、性别、活动水平、健康目标、当前BMR、当前TDEE、每日卡路里目标
4. 用户点击编辑按钮，表单字段变为可编辑状态
5. 用户修改需要更新的字段（身高、体重、年龄、活动水平、健康目标等）
6. 用户点击保存按钮提交修改
7. 后端接收更新数据并进行验证
8. 系统重新计算BMR、TDEE和每日卡路里目标（如果相关字段被修改）
9. 系统更新数据库中的用户档案信息
10. 返回成功响应，界面显示更新后的信息

# Confirmation

1. 个人资料页面完整显示所有用户信息
2. 邮箱字段为只读，不可编辑
3. 所有可编辑字段的数据验证规则与初始输入时一致
4. 如果修改了身高、体重、年龄、性别或活动水平，系统自动重新计算BMR和TDEE
5. 如果修改了健康目标，系统自动重新计算每日卡路里目标
6. 数据更新成功后返回HTTP状态码200 OK
7. 如果验证失败，返回400 Bad Request及具体错误信息
8. 界面实时显示更新后的计算结果（BMR、TDEE、卡路里目标）
9. 提供取消按钮，允许用户放弃修改

**参考**: SRS文档第6页 - 账号信息管理模块 - 个人资料查看与编辑功能

---

## Issue #8: 密码重置

# Card

作为忘记密码的用户，我想通过邮箱验证码重置我的密码，以便能够重新登录系统使用卡路里记录功能。

# Conversation

1. 用户在登录页面点击"忘记密码"链接
2. 系统跳转到密码重置页面
3. 用户输入注册时使用的邮箱地址
4. 用户点击"发送验证码"按钮
5. 后端验证邮箱是否在系统中注册
6. 系统生成6位数字验证码，设置5分钟有效期
7. 系统将验证码发送到用户邮箱
8. 用户查收邮件并在界面输入验证码
9. 用户输入新密码并确认新密码（两次输入需一致）
10. 用户点击"重置密码"按钮提交
11. 后端验证验证码的有效性和正确性
12. 后端验证新密码格式是否符合安全要求
13. 系统使用加密算法（如BCrypt）加密新密码并更新到数据库
14. 返回成功响应，引导用户使用新密码登录

# Confirmation

1. 邮箱格式验证通过
2. 系统正确验证邮箱是否已注册，未注册返回404 Not Found
3. 验证码为6位随机数字，有效期5分钟
4. 验证码发送成功，邮件内容包含验证码和有效期说明
5. 验证码验证正确且在有效期内
6. 新密码两次输入一致性验证通过
7. 新密码符合安全要求（长度、复杂度等）
8. 密码使用BCrypt等安全加密算法加密后存储
9. 数据库密码更新成功，返回HTTP状态码200 OK
10. 如果验证码错误或过期，返回400 Bad Request及错误提示
11. 如果邮箱未注册，返回404 Not Found及提示信息
12. 密码重置成功后，之前的验证码立即失效
13. 界面提示密码重置成功，引导用户返回登录页面

**参考**: SRS文档第6页 - 账号信息管理模块 - 密码重置功能

---

## 使用说明

1. 每个issue的内容已经按照要求格式化为：Card / Conversation / Confirmation 三部分
2. Confirmation部分使用顺序列表（numbered list）格式
3. 所有内容都基于SRS文档要求编写
4. 您可以直接复制每个issue的内容，粘贴到GitLab对应issue的描述字段中进行更新

## 文件说明

- `issue2.json` - Issue #2 用户注册
- `issue4.json` - Issue #4 用户身体基本数据收集
- `issue5.json` - Issue #5 健康目标设定
- `issue6.json` - Issue #6 活动水平选择
- `issue7.json` - Issue #7 个人资料查看与编辑
- `issue8.json` - Issue #8 密码重置
