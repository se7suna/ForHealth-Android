# 本地开发环境配置指南

## 快速开始

### 1. 配置环境变量

首次运行时，复制 `.env.example` 创建 `.env` 文件：

```bash
cp .env.example .env
```

> **重要**: `.env` 文件不会提交到 Git，每个开发者需要自己创建

### 2. 启动邮件服务 MailHog

本地开发环境使用 MailHog 作为邮件服务器，与生产环境保持一致。

```bash
# 在项目根目录下执行
docker-compose up -d mailhog
```

验证 MailHog 是否启动成功：
- SMTP 服务：`localhost:1025`
- Web UI：访问 http://localhost:8025

### 3. 启动 MongoDB

```bash
docker-compose up -d mongodb
```

### 4. 安装依赖并启动后端

```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

## 邮件功能测试

### 查看验证码邮件

1. 在应用中触发邮件发送（如注册、重置密码）
2. 打开浏览器访问 http://localhost:8025
3. 在 MailHog Web UI 中查看收到的邮件和验证码

### 为什么使用 MailHog？

✅ **与生产环境一致** - 生产环境也使用 MailHog/MailPit
✅ **无需真实邮箱** - 不需要配置 Gmail/QQ 邮箱等
✅ **方便调试** - Web UI 直接查看邮件内容
✅ **安全** - 不会泄露真实邮箱凭据到代码仓库

## 常见问题

### Q1: 邮件发送失败 - "Username and Password not accepted"

**原因**: 本地 `.env` 文件配置了真实邮箱（如 Gmail），但凭据不正确。

**解决**:
1. 检查 `.env` 文件中的邮件配置是否为：
   ```
   SMTP_HOST=localhost
   SMTP_PORT=1025
   SMTP_USER=
   SMTP_PASSWORD=
   ```
2. 确认 MailHog 已启动：`docker ps | grep mailhog`
3. 如未启动，执行：`docker-compose up -d mailhog`

### Q2: 启动 MailHog 失败

**解决**:
```bash
# 停止所有容器
docker-compose down

# 重新启动 MailHog
docker-compose up -d mailhog

# 查看日志
docker logs for_health_mailhog
```

### Q3: 看不到验证码邮件

**检查步骤**:
1. 确认后端日志中邮件发送成功（没有报错）
2. 访问 http://localhost:8025 查看 MailHog Web UI
3. 检查 MailHog 容器状态：`docker ps | grep mailhog`

## 生产环境对齐

本地开发配置已与生产环境对齐：

| 配置项 | 本地开发 | 生产环境 | 状态 |
|--------|---------|---------|------|
| 邮件服务 | MailHog | MailHog | ✅ 一致 |
| SMTP 端口 | 1025 | 1025 | ✅ 一致 |
| 数据库 | MongoDB | MongoDB | ✅ 一致 |

这样可以避免"在我本地能跑，但生产环境不行"的问题。
