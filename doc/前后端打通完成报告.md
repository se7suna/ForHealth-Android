# For Health å‰åç«¯æ‰“é€šå®ŒæˆæŠ¥å‘Š

## ğŸ“… å®Œæˆæ—¥æœŸ
2025-10-29

## âœ… å®Œæˆæ¦‚è¿°

æˆåŠŸå°†å‰ç«¯Androidåº”ç”¨ä¸åç«¯FastAPIæœåŠ¡æ‰“é€šï¼Œå®ç°äº†å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æ•°æ®å¡«å†™å’Œä¸ªäººä¿¡æ¯æŸ¥çœ‹åŠŸèƒ½ã€‚

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### 1. Gradleé…ç½®æ–‡ä»¶
- **`frontend/app/build.gradle.kts`**
  - æ·»åŠ Retrofit 2.9.0
  - æ·»åŠ OkHttp 4.11.0å’Œæ—¥å¿—æ‹¦æˆªå™¨
  - æ·»åŠ Gson 2.10.1
  - æ·»åŠ Coroutines 1.7.3
  - ä¿®æ­£compileSdkå’ŒtargetSdké…ç½®

### 2. AndroidManifesté…ç½®
- **`frontend/app/src/main/AndroidManifest.xml`**
  - æ·»åŠ INTERNETæƒé™
  - æ·»åŠ ACCESS_NETWORK_STATEæƒé™
  - é…ç½®usesCleartextTrafficå…è®¸HTTP
  - æ³¨å†ŒForHealthApplicationç±»

### 3. æ–°å¢æ ¸å¿ƒæ–‡ä»¶

#### Applicationç±»
- **`frontend/app/src/main/java/com/example/forhealth/ForHealthApplication.kt`**
  - åº”ç”¨åˆå§‹åŒ–ç±»
  - åˆå§‹åŒ–RetrofitClient

#### å·¥å…·ç±»
- **`frontend/app/src/main/java/com/example/forhealth/utils/DataMapper.kt`**
  - ä¸­è‹±æ–‡å­—æ®µæ˜ å°„
  - æ€§åˆ«è½¬æ¢ï¼ˆç”·/å¥³ â†” male/femaleï¼‰
  - æ´»åŠ¨æ°´å¹³è½¬æ¢ï¼ˆä¸­æ–‡ â†” è‹±æ–‡æšä¸¾ï¼‰
  - ç›®æ ‡ç±»å‹è½¬æ¢ï¼ˆä¸­æ–‡ â†” è‹±æ–‡æšä¸¾ï¼‰
  - æ—¥æœŸæ ¼å¼è½¬æ¢

#### ç½‘ç»œå±‚
- **`frontend/app/src/main/java/com/example/forhealth/network/ApiInterface.kt`**
  - Retrofitæ¥å£å®šä¹‰
  - ç™»å½•ã€æ³¨å†Œã€è·å–èµ„æ–™ã€æ›´æ–°èµ„æ–™æ¥å£

#### æ•°æ®æ¨¡å‹
- **`frontend/app/src/main/java/com/example/forhealth/model/MessageResponse.kt`**
  - æ³¨å†Œæ¥å£å“åº”æ¨¡å‹

### 4. ä¿®æ”¹çš„æ–‡ä»¶

#### ç½‘ç»œå®¢æˆ·ç«¯
- **`frontend/app/src/main/java/com/example/forhealth/network/RetrofitClient.kt`**
  - ä»æ¨¡æ‹Ÿå®ç°æ”¹ä¸ºçœŸå®Retrofitå®ç°
  - é…ç½®OkHttpå®¢æˆ·ç«¯ï¼ˆè¶…æ—¶ã€æ—¥å¿—æ‹¦æˆªå™¨ï¼‰
  - é…ç½®Gsonè½¬æ¢å™¨
  - å®ç°ApiServiceæ¥å£
  - é›†æˆTokenç®¡ç†

#### æ•°æ®æ¨¡å‹
- **`frontend/app/src/main/java/com/example/forhealth/model/User.kt`**
  - æ›´æ–°å­—æ®µä»¥åŒ¹é…åç«¯API
  - æ·»åŠ birthdateã€health_goal_typeç­‰å­—æ®µ
  - æ”¯æŒåç«¯çš„å­—æ®µå‘½åè§„èŒƒ

#### Activityä¿®æ”¹

- **`frontend/app/src/main/java/com/example/forhealth/auth/RegisterActivity.kt`**
  - æ·»åŠ ç”¨æˆ·åè¾“å…¥å­—æ®µ
  - æ·»åŠ usernameéªŒè¯ï¼ˆè‡³å°‘2ä¸ªå­—ç¬¦ï¼‰
  - ä¿®æ”¹æ³¨å†Œè¯·æ±‚åŒ…å«username
  - æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•

- **`frontend/app/src/main/java/com/example/forhealth/user/HealthGoalActivity.kt`**
  - ä½¿ç”¨DataMapperè½¬æ¢æ•°æ®
  - å°†birthdateè½¬æ¢ä¸ºYYYY-MM-DDæ ¼å¼
  - å°†ä¸­æ–‡å­—æ®µè½¬æ¢ä¸ºè‹±æ–‡æšä¸¾
  - æ•°å€¼ç±»å‹è½¬æ¢ä¸ºDouble

- **`frontend/app/src/main/java/com/example/forhealth/user/ProfileActivity.kt`**
  - ä½¿ç”¨DataMapperæ˜¾ç¤ºæ•°æ®
  - å°†åç«¯è‹±æ–‡å­—æ®µè½¬æ¢ä¸ºä¸­æ–‡æ˜¾ç¤º
  - æ”¯æŒå¤šç§å­—æ®µåç§°ï¼ˆå…¼å®¹æ€§ï¼‰
  - æ ¼å¼åŒ–æ•°å€¼æ˜¾ç¤º

#### å¸ƒå±€æ–‡ä»¶

- **`frontend/app/src/main/res/layout/activity_register.xml`**
  - æ·»åŠ usernameè¾“å…¥æ¡†
  - è°ƒæ•´å¸ƒå±€é—´è·

#### èµ„æºæ–‡ä»¶

- **`frontend/app/src/main/res/values/strings.xml`**
  - æ·»åŠ hint_usernameå­—ç¬¦ä¸²

## ğŸ“‹ ä¸»è¦æŠ€æœ¯å®ç°

### 1. ç½‘ç»œè¯·æ±‚æ¶æ„

```
å‰ç«¯Activity
    â†“
ApiService (æ¥å£æŠ½è±¡)
    â†“
RetrofitClient (å®ç°)
    â†“
ApiInterface (Retrofitæ¥å£)
    â†“
OkHttpå®¢æˆ·ç«¯
    â†“
åç«¯API
```

### 2. æ•°æ®è½¬æ¢æµç¨‹

#### å‘é€æ•°æ®åˆ°åç«¯ï¼š
```
å‰ç«¯ä¸­æ–‡æ•°æ® â†’ DataMapperè½¬æ¢ â†’ åç«¯è‹±æ–‡æ ¼å¼ â†’ APIè¯·æ±‚
```

ä¾‹å¦‚ï¼š
```kotlin
"ç”·" â†’ DataMapper.genderToBackend() â†’ "male"
"ä¸­åº¦æ´»è·ƒ" â†’ DataMapper.activityLevelToBackend() â†’ "moderately_active"
```

#### ä»åç«¯æ¥æ”¶æ•°æ®ï¼š
```
APIå“åº” â†’ åç«¯è‹±æ–‡æ ¼å¼ â†’ DataMapperè½¬æ¢ â†’ å‰ç«¯ä¸­æ–‡æ˜¾ç¤º
```

ä¾‹å¦‚ï¼š
```kotlin
"male" â†’ DataMapper.genderFromBackend() â†’ "ç”·"
"moderately_active" â†’ DataMapper.activityLevelFromBackend() â†’ "ä¸­åº¦æ´»è·ƒ"
```

### 3. Tokenç®¡ç†

- ç™»å½•/æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ä¿å­˜Tokenåˆ°SharedPreferences
- éœ€è¦è®¤è¯çš„è¯·æ±‚è‡ªåŠ¨æ·»åŠ  `Authorization: Bearer {token}` header
- é€€å‡ºç™»å½•æ—¶æ¸…é™¤Token

### 4. é”™è¯¯å¤„ç†

- ç½‘ç»œè¯·æ±‚ä½¿ç”¨try-catchæ•è·å¼‚å¸¸
- ä½¿ç”¨Resultç±»å‹å°è£…æˆåŠŸ/å¤±è´¥çŠ¶æ€
- åœ¨UIçº¿ç¨‹æ˜¾ç¤ºé”™è¯¯æç¤º

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½å®ç°

### âœ… ç”¨æˆ·æ³¨å†Œ
- [x] è¾“å…¥ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
- [x] å‰ç«¯è¡¨å•éªŒè¯
- [x] å‘é€æ³¨å†Œè¯·æ±‚åˆ°åç«¯
- [x] æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•
- [x] è·å–Tokenå¹¶ä¿å­˜

### âœ… ç”¨æˆ·ç™»å½•
- [x] è¾“å…¥é‚®ç®±ã€å¯†ç 
- [x] å‘é€ç™»å½•è¯·æ±‚åˆ°åç«¯
- [x] è·å–å¹¶ä¿å­˜Token
- [x] æ™ºèƒ½åˆ¤æ–­è·³è½¬ï¼ˆå·²å¡«å†™æ•°æ®â†’ä¸»é¡µï¼Œæœªå¡«å†™â†’æ•°æ®å¡«å†™ï¼‰

### âœ… æ•°æ®å¡«å†™
- [x] æ€§åˆ«ã€å‡ºç”Ÿæ—¥æœŸã€èº«é«˜ã€ä½“é‡
- [x] æ´»åŠ¨æ°´å¹³é€‰æ‹©
- [x] å¥åº·ç›®æ ‡è®¾å®š
- [x] æ•°æ®æ ¼å¼è½¬æ¢ï¼ˆä¸­æ–‡â†’è‹±æ–‡ï¼‰
- [x] ä¸€æ¬¡æ€§æäº¤æ‰€æœ‰æ•°æ®åˆ°åç«¯

### âœ… ä¸ªäººä¿¡æ¯
- [x] ä»åç«¯è·å–ç”¨æˆ·å®Œæ•´èµ„æ–™
- [x] æ•°æ®æ ¼å¼è½¬æ¢ï¼ˆè‹±æ–‡â†’ä¸­æ–‡ï¼‰
- [x] ç¾è§‚çš„ä¿¡æ¯å±•ç¤º
- [x] æ”¯æŒä¿¡æ¯ä¿®æ”¹ï¼Œç”¨æˆ·å¯ä»¥é‡æ–°å½•å…¥ä¸ªäººä¿¡æ¯

### âœ… é€€å‡ºç™»å½•
- [x] æ¸…é™¤æœ¬åœ°Token
- [x] è¿”å›ç™»å½•é¡µé¢

## ğŸ”„ æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ³¨å†Œé¡µé¢   â”‚ â†’ POST /api/auth/register (username, email, password)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â†“
                  æ³¨å†ŒæˆåŠŸ
                      â†“
                POST /api/auth/login (email, password)
                      â†“
                  è·å–Token
                      â†“
                ä¿å­˜åˆ°SharedPreferences
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®å¡«å†™æµç¨‹ â”‚ â†’ æ”¶é›†æ‰€æœ‰ç”¨æˆ·æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â†“
                  DataMapperè½¬æ¢
                      â†“
                PUT /api/user/profile (è½¬æ¢åçš„æ•°æ®)
                      â†“
                  ä¿å­˜æˆåŠŸ
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ä¸»é¡µ      â”‚ â† è·³è½¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â†“
                  ç‚¹å‡»ä¸ªäººä¿¡æ¯
                      â†“
                GET /api/user/profile
                (Authorization: Bearer {token})
                      â†“
                  è·å–ç”¨æˆ·æ•°æ®
                      â†“
                  DataMapperè½¬æ¢
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸ªäººä¿¡æ¯é¡µé¢ â”‚ â† æ˜¾ç¤ºä¸­æ–‡æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å­—æ®µæ˜ å°„è¡¨

### æ€§åˆ« (Gender)
| å‰ç«¯æ˜¾ç¤º | åç«¯å­˜å‚¨ |
|---------|---------|
| ç”·      | male    |
| å¥³      | female  |

### æ´»åŠ¨æ°´å¹³ (Activity Level)
| å‰ç«¯æ˜¾ç¤º   | åç«¯å­˜å‚¨              | PALç³»æ•° |
|-----------|--------------------- |---------|
| ä¹…å      | sedentary            | 1.2     |
| è½»åº¦æ´»è·ƒ   | lightly_active       | 1.375   |
| ä¸­åº¦æ´»è·ƒ   | moderately_active    | 1.55    |
| éå¸¸æ´»è·ƒ   | very_active          | 1.725   |
| æå…¶æ´»è·ƒ   | extremely_active     | 1.9     |

### å¥åº·ç›®æ ‡ (Health Goal)
| å‰ç«¯æ˜¾ç¤º  | åç«¯å­˜å‚¨           | å¡è·¯é‡Œè®¡ç®—  |
|----------|------------------|-----------|
| å‡é‡     | lose_weight      | TDEE - 500|
| ç»´æŒä½“é‡  | maintain_weight  | TDEE      |
| å¢é‡     | gain_weight      | TDEE + 500|






**å®Œæˆæ—¶é—´**: 2025-10-29



